addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
});

async function handleRequest(request) {
  const url = new URL(request.url);

  // Serve the editor HTML at the root path
  if (url.pathname === '/') {
    const editorHtml = "<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>\u6210\u7ee9\u5355\u7f16\u8f91\u5668</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            margin: 0;\n            padding: 0;\n            background-color: #f4f4f4;\n            color: #333;\n            display: flex;\n            flex-direction: column;\n            min-height: 100vh;\n            overflow: hidden; /* Prevent body scrollbars when resizing */\n        }\n        .main-container {\n            display: flex;\n            flex-grow: 1;\n            padding: 10px;\n            gap: 0; /* Remove gap for splitter */\n            overflow: hidden; /* Prevent main container scrollbars */\n        }\n        .editor-pane {\n            /* flex: 3; */ /* Will be controlled by JS */\n            background-color: #fff;\n            padding: 15px;\n            border-radius: 8px 0 0 8px; /* Adjust border radius for splitter */\n            box-shadow: 0 0 10px rgba(0,0,0,0.1);\n            overflow-y: auto;\n            max-height: calc(100vh - 40px);\n            min-width: 200px; /* Minimum width for editor */\n        }\n        .splitter {\n            width: 10px;\n            background-color: #e0e0e0;\n            cursor: col-resize;\n            flex-shrink: 0;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n        .splitter-handle {\n            width: 2px;\n            height: 30px;\n            background-color: #aeaeae;\n        }\n        .preview-pane {\n            /* flex: 2; */ /* Will be controlled by JS */\n            background-color: #fff;\n            padding: 15px;\n            border-radius: 0 8px 8px 0; /* Adjust border radius for splitter */\n            box-shadow: 0 0 10px rgba(0,0,0,0.1);\n            overflow-y: auto;\n            max-height: calc(100vh - 40px);\n            min-width: 200px; /* Minimum width for preview */\n        }\n        .preview-pane h2 {\n            margin-top: 0;\n        }\n        #transcriptPreviewOutput {\n            border: 1px solid #ccc;\n            padding: 10px;\n            min-height: 330px; \n            background-color: #f9f9f9;\n            overflow: auto; \n            position: relative; \n        }\n\n        .print-artifact {\n            position: absolute;\n            background-color: rgba(0, 0, 0, 0.2);\n            border-radius: 50%;\n            pointer-events: none; \n        }\n\n        .editor-pane h1, .editor-pane h2, .editor-pane h3 {\n            color: #333;\n            margin-top: 10px;\n            margin-bottom: 8px;\n        }\n        .editor-pane h1 { font-size: 1.5em; }\n        .editor-pane h2 { font-size: 1.2em; }\n        .editor-pane h3 { font-size: 1.0em; }\n\n        .editor-pane label {\n            display: block;\n            margin-top: 8px;\n            margin-bottom: 2px;\n            font-weight: bold;\n            font-size: 0.9em;\n        }\n        .editor-pane input[type=\"text\"],\n        .editor-pane input[type=\"date\"],\n        .editor-pane input[type=\"number\"],\n        .editor-pane select,\n        .editor-pane textarea {\n            width: calc(100% - 16px);\n            padding: 8px;\n            margin-top: 3px;\n            border: 1px solid #ddd;\n            border-radius: 3px;\n            box-sizing: border-box;\n            font-size: 0.9em;\n        }\n        .editor-pane .grid-container {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 10px;\n        }\n        .editor-pane .form-section {\n            border: 1px solid #eee;\n            padding: 10px;\n            border-radius: 5px;\n            margin-bottom: 15px;\n        }\n        .editor-pane .courses-section .course-year-block {\n            border: 1px dashed #ccc;\n            padding: 10px;\n            margin-top: 10px;\n            border-radius: 5px;\n        }\n        .editor-pane .courses-section .course-row {\n            display: flex;\n            gap: 5px;\n            align-items: center;\n            margin-bottom: 3px;\n        }\n        .editor-pane .courses-section .course-row input[type=\"text\"] {\n            flex-grow: 1;\n        }\n         .editor-pane .courses-section .course-row input[type=\"checkbox\"] {\n            width: auto;\n            margin-left: 5px;\n            vertical-align: middle;\n        }\n        .editor-pane .courses-section .course-row button {\n            padding: 5px 8px;\n            font-size: 0.8em;\n        }\n        .editor-pane button {\n            padding: 8px 12px;\n            font-size: 0.9em;\n            margin-top: 8px;\n        }\n        .editor-pane .add-button { background-color: #2ecc71; color: white; border: none; cursor: pointer;}\n        .editor-pane .add-button:hover { background-color: #27ae60; }\n        .editor-pane textarea { min-height: 40px; }\n\n        .highlight-setting label {\n            font-weight: normal;\n            display: inline-block;\n            margin-left: 5px;\n        }\n        .highlight-setting input[type=\"checkbox\"] {\n            display: inline-block;\n            width: auto;\n            margin-top: 0;\n            vertical-align: middle;\n        }\n\n        @media (max-width: 768px) {\n            .main-container {\n                flex-direction: column;\n                overflow: auto; /* Allow scroll on mobile */\n            }\n            .editor-pane, .preview-pane {\n                flex: none;\n                width: calc(100% - 30px); /* Account for padding */\n                max-height: none;\n                margin-bottom: 10px;\n                border-radius: 8px; /* Restore full border radius on mobile */\n            }\n            .splitter {\n                display: none; /* Hide splitter on mobile */\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"main-container\">\n        <div class=\"editor-pane\" id=\"editorPane\">\n            <h1>\u6210\u7ee9\u5355\u7f16\u8f91\u5668</h1>\n            <form id=\"transcriptForm\">\n                <!-- Form content from v6, truncated for brevity -->\n                <div class=\"form-section\">\n                    <h2>\u5b66\u6821\u4fe1\u606f</h2>\n                    <label for=\"schoolName\">\u5b66\u6821\u540d\u79f0: <span class=\"tooltip-icon\" title=\"填写学校的全称\">?</span></label>\n                    <input type=\"text\" id=\"schoolName\" name=\"schoolName\" value=\"Sun Canyon High\" oninput=\"updatePreview()\">\n                    <label for=\"schoolPhone\">\u5b66\u6821\u7535\u8bdd: <span class=\"tooltip-icon\" title=\"填写学校的联系电话\">?</span></label>\n                    <input type=\"text\" id=\"schoolPhone\" name=\"schoolPhone\" value=\"435-635-1900\" oninput=\"updatePreview()\">\n                    <label for=\"schoolAddress\">\u5b66\u6821\u5730\u5740 (\u9875\u811a): <span class=\"tooltip-icon\" title=\"填写学校的完整地址，将显示在成绩单底部\">?</span></label>\n                    <input type=\"text\" id=\"schoolAddress\" name=\"schoolAddress\" value=\"Sun Canyon High 1375 S. Sand Flow Drive St George, UT 84770\" oninput=\"updatePreview()\">\n                </div>\n    \n                <div class=\"form-section\">\n                    <h2>\u5b66\u751f\u4e2a\u4fe1\u606f</h2>\n                    <div class=\"grid-container\">\n                        <div>\n                            <label for=\"studentName\">\u59d3\u540d: <span class=\"tooltip-icon\" title=\"填写学生的完整姓名\">?</span></label>\n                            <input type=\"text\" id=\"studentName\" name=\"studentName\" value=\"James Bond\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"studentAddress1\">\u5730\u5740\u884c1: <span class=\"tooltip-icon\" title=\"填写学生地址的第一行\">?</span></label>\n                            <input type=\"text\" id=\"studentAddress1\" name=\"studentAddress1\" value=\"007 Spy Ave.\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"studentAddress2\">\u5730\u5740\u884c2 (\u57ce\u5e02, \u5dde \u90ae\u7f16): <span class=\"tooltip-icon\" title=\"填写学生地址的第二行，包含城市、州和邮编\">?</span></label>\n                            <input type=\"text\" id=\"studentAddress2\" name=\"studentAddress2\" value=\"City, UT 90210\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"sn\">SN: <span class=\"tooltip-icon\" title=\"填写学生的学号或标识符\">?</span></label>\n                            <input type=\"text\" id=\"sn\" name=\"sn\" value=\"007007\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"grade\">Grade: <span class=\"tooltip-icon\" title=\"填写学生的年级\">?</span></label>\n                            <input type=\"text\" id=\"grade\" name=\"grade\" value=\"12\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"ssid\">SSID: <span class=\"tooltip-icon\" title=\"填写学生的SSID\">?</span></label>\n                            <input type=\"text\" id=\"ssid\" name=\"ssid\" value=\"123456\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"gender\">Gender: <span class=\"tooltip-icon\" title=\"填写学生的性别\">?</span></label>\n                            <input type=\"text\" id=\"gender\" name=\"gender\" value=\"M\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"birthdate\">Birthdate: <span class=\"tooltip-icon\" title=\"填写学生的出生日期\">?</span></label>\n                            <input type=\"text\" id=\"birthdate\" name=\"birthdate\" value=\"01/01/2001\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"gradDate\">Grad. Date: <span class=\"tooltip-icon\" title=\"填写学生的毕业日期\">?</span></label>\n                            <input type=\"text\" id=\"gradDate\" name=\"gradDate\" value=\"\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"exitDate\">Exit Date: <span class=\"tooltip-icon\" title=\"填写学生的离校日期\">?</span></label>\n                            <input type=\"text\" id=\"exitDate\" name=\"exitDate\" value=\"05/22/2020\" oninput=\"updatePreview()\">\n                        </div>\n                    </div>\n                </div>\n    \n                <div class=\"form-section\">\n                    <h2>\u6210\u7ee9\u6c47\u603b</h2>\n                    <div class=\"grid-container\">\n                        <div>\n                            <label for=\"cumulativeCredit\">Cumulative Credit: <span class=\"tooltip-icon\" title=\"填写累计获得的学分\">?</span></label>\n                            <input type=\"text\" id=\"cumulativeCredit\" name=\"cumulativeCredit\" value=\"29.583\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"cumulativeGpa\">Cumulative GPA: <span class=\"tooltip-icon\" title=\"填写累计GPA\">?</span></label>\n                            <input type=\"text\" id=\"cumulativeGpa\" name=\"cumulativeGpa\" value=\"3.975\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"classRank\">Class Rank: <span class=\"tooltip-icon\" title=\"填写班级排名\">?</span></label>\n                            <input type=\"text\" id=\"classRank\" name=\"classRank\" value=\"21 of 395\" oninput=\"updatePreview()\">\n                        </div>\n                    </div>\n                    <h3>\u6309\u5b66\u5e74</h3>\n                    <div class=\"grid-container\">\n                        <div>\n                            <label for=\"gpa12thCredit\">12th Credit: <span class=\"tooltip-icon\" title=\"填写12年级获得的学分\">?</span></label>\n                            <input type=\"text\" id=\"gpa12thCredit\" name=\"gpa12thCredit\" value=\"1.333\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"gpa12thGpa\">12th GPA: <span class=\"tooltip-icon\" title=\"填写12年级GPA\">?</span></label>\n                            <input type=\"text\" id=\"gpa12thGpa\" name=\"gpa12thGpa\" value=\"3.821\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"gpa11thCredit\">11th Credit: <span class=\"tooltip-icon\" title=\"填写11年级获得的学分\">?</span></label>\n                            <input type=\"text\" id=\"gpa11thCredit\" name=\"gpa11thCredit\" value=\"11.500\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"gpa11thGpa\">11th GPA: <span class=\"tooltip-icon\" title=\"填写11年级GPA\">?</span></label>\n                            <input type=\"text\" id=\"gpa11thGpa\" name=\"gpa11thGpa\" value=\"3.955\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"gpa10thCredit\">10th Credit: <span class=\"tooltip-icon\" title=\"填写10年级获得的学分\">?</span></label>\n                            <input type=\"text\" id=\"gpa10thCredit\" name=\"gpa10thCredit\" value=\"9.500\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"gpa10thGpa\">10th GPA: <span class=\"tooltip-icon\" title=\"填写10年级GPA\">?</span></label>\n                            <input type=\"text\" id=\"gpa10thGpa\" name=\"gpa10thGpa\" value=\"4.000\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"gpa9thCredit\">9th Credit: <span class=\"tooltip-icon\" title=\"填写9年级获得的学分\">?</span></label>\n                            <input type=\"text\" id=\"gpa9thCredit\" name=\"gpa9thCredit\" value=\"7.250\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"gpa9thGpa\">9th GPA: <span class=\"tooltip-icon\" title=\"填写9年级GPA\">?</span></label>\n                            <input type=\"text\" id=\"gpa9thGpa\" name=\"gpa9thGpa\" value=\"4.000\" oninput=\"updatePreview()\">\n                        </div>\n                    </div>\n                    <h3>\u6d4b\u8bd5\u6210\u7ee9 (ACT/SAT)</h3>\n                    <div class=\"grid-container\">\n                        <div>\n                            <label for=\"actTestDate\">ACT Test Date: <span class=\"tooltip-icon\" title=\"填写ACT考试日期\">?</span></label>\n                            <input type=\"text\" id=\"actTestDate\" name=\"actTestDate\" value=\"06/01/2019\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"actComposite\">ACT Composite: <span class=\"tooltip-icon\" title=\"填写ACT综合分数\">?</span></label>\n                            <input type=\"text\" id=\"actComposite\" name=\"actComposite\" value=\"31\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"actEnglish\">ACT English (v): <span class=\"tooltip-icon\" title=\"填写ACT英语分数\">?</span></label>\n                            <input type=\"text\" id=\"actEnglish\" name=\"actEnglish\" value=\"26\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"actMath\">ACT Math (m): <span class=\"tooltip-icon\" title=\"填写ACT数学分数\">?</span></label>\n                            <input type=\"text\" id=\"actMath\" name=\"actMath\" value=\"29\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"actReading\">ACT Reading: <span class=\"tooltip-icon\" title=\"填写ACT阅读分数\">?</span></label>\n                            <input type=\"text\" id=\"actReading\" name=\"actReading\" value=\"36\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"actScience\">ACT Science: <span class=\"tooltip-icon\" title=\"填写ACT科学分数\">?</span></label>\n                            <input type=\"text\" id=\"actScience\" name=\"actScience\" value=\"31\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"actWriting\">ACT English Writing: <span class=\"tooltip-icon\" title=\"填写ACT写作分数\">?</span></label>\n                            <input type=\"text\" id=\"actWriting\" name=\"actWriting\" value=\"0\" oninput=\"updatePreview()\">\n                        </div>\n                    </div>\n                     <div class=\"grid-container\">\n                        <div>\n                            <label for=\"satTestDate\">SAT Test Date: <span class=\"tooltip-icon\" title=\"填写SAT考试日期\">?</span></label>\n                            <input type=\"text\" id=\"satTestDate\" name=\"satTestDate\" value=\"00/00/0000\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"satComposite\">SAT Composite: <span class=\"tooltip-icon\" title=\"填写SAT综合分数\">?</span></label>\n                            <input type=\"text\" id=\"satComposite\" name=\"satComposite\" value=\"0.0\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"satEnglish\">SAT English (v): <span class=\"tooltip-icon\" title=\"填写SAT英语分数\">?</span></label>\n                            <input type=\"text\" id=\"satEnglish\" name=\"satEnglish\" value=\"0.0\" oninput=\"updatePreview()\">\n                        </div>\n                        <div>\n                            <label for=\"satMath\">SAT Math (m): <span class=\"tooltip-icon\" title=\"填写SAT数学分数\">?</span></label>\n                            <input type=\"text\" id=\"satMath\" name=\"satMath\" value=\"0.0\" oninput=\"updatePreview()\">\n                        </div>\n                         <div>\n                            <label for=\"satWriting\">SAT English Writing: <span class=\"tooltip-icon\" title=\"填写SAT写作分数\">?</span></label>\n                            <input type=\"text\" id=\"satWriting\" name=\"satWriting\" value=\"0.0\" oninput=\"updatePreview()\">\n                        </div>\n                    </div>\n                </div>\n    \n                <div class=\"form-section courses-section\">\n                    <h2>\u8bfe\u7a0b\u8be6\u60c5</h2>\n                    <div id=\"courseYearsContainer\">\n                    </div>\n                    <button type=\"button\" class=\"add-button\" onclick=\"addCourseYear()\">\u6dfb\u52a0\u5b66\u5e74/\u5b66\u671f\u533a\u5757</button>\n                </div>\n    \n                <div class=\"form-section\">\n                    <h2>GPA \u5e74\u5ea6\u5c0f\u7ed3 (\u5e95\u90e8)</h2>\n                    <div id=\"gpaSummaryContainer\">\n                    </div>\n                    <button type=\"button\" class=\"add-button\" onclick=\"addGpaSummaryLine()\">\u6dfb\u52a0GPA\u5c0f\u7ed3\u884c</button>\n                </div>\n    \n                <div class=\"form-section\">\n                    <h2>\u9875\u811a\u4fe1\u606f</h2>\n                    <label for=\"footerNotes\">\u5907\u6ce8\u4fe1\u606f (All grades are based on...): <span class=\"tooltip-icon\" title=\"填写成绩单底部的备注信息\">?</span></label>\n                    <textarea id=\"footerNotes\" name=\"footerNotes\" oninput=\"updatePreview()\">All grades are based on a 4.000 scale. Credit and grades are issued quarterly with a typical course earning 0.25 units of credit per quarter or 1.00 credit per year. 28 credits, grades 9-12, are required for graduation.</textarea>\n                    <label for=\"transcriptGeneratedText\">\u751f\u6210\u6587\u672c (Official Electronically Generated Transcript): <span class=\"tooltip-icon\" title=\"填写成绩单生成方式的文本\">?</span></label>\n                    <input type=\"text\" id=\"transcriptGeneratedText\" name=\"transcriptGeneratedText\" value=\"Official Electronically Generated Transcript\" oninput=\"updatePreview()\">\n                    <label for=\"signatureLine1\">\u7b7e\u540d\u884c1 (Signature): <span class=\"tooltip-icon\" title=\"填写签名行1的文本\">?</span></label>\n                    <input type=\"text\" id=\"signatureLine1\" name=\"signatureLine1\" value=\"Signature\" oninput=\"updatePreview()\">\n                    <label for=\"signatureLine2\">\u7b7e\u540d\u884c2 (Title): <span class=\"tooltip-icon\" title=\"填写签名行2的文本\">?</span></label>\n                    <input type=\"text\" id=\"signatureLine2\" name=\"signatureLine2\" value=\"Title\" oninput=\"updatePreview()\">\n                    <label for=\"signatureLine3\">\u7b7e\u540d\u884c3 (Date): <span class=\"tooltip-icon\" title=\"填写签名行3的文本\">?</span></label>\n                    <input type=\"text\" id=\"signatureLine3\" name=\"signatureLine3\" value=\"Date\" oninput=\"updatePreview()\">\n                    <label for=\"accreditation\">\u8ba4\u8bc1\u4fe1\u606f: <span class=\"tooltip-icon\" title=\"填写认证信息\">?</span></label>\n                    <input type=\"text\" id=\"accreditation\" name=\"accreditation\" value=\"School Fully Accredited by Northwest Association of Schools and Colleges\" oninput=\"updatePreview()\">\n                    <label for=\"issueDate\">\u7b7e\u53d1\u65e5\u671f (\u53f3\u4e0b\u89d2): <span class=\"tooltip-icon\" title=\"填写成绩单签发日期\">?</span></label>\n                    <input type=\"text\" id=\"issueDate\" name=\"issueDate\" value=\"10/24/19\" oninput=\"updatePreview()\">\n                </div>\n    \n                <div class=\"form-section\">\n                    <h2>\u9ad8\u4eae\u8bbe\u7f6e (\u9009\u62e9\u9700\u8981\u9ad8\u4eae\u7684\u5b57\u6bb5)</h2>\n                    <div class=\"grid-container\">\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-schoolName\" name=\"highlight-schoolName\" onchange=\"updatePreview()\"><label for=\"highlight-schoolName\">\u5b66\u6821\u540d\u79f0</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-schoolPhone\" name=\"highlight-schoolPhone\" onchange=\"updatePreview()\"><label for=\"highlight-schoolPhone\">\u5b66\u6821\u7535\u8bdd</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-schoolAddress\" name=\"highlight-schoolAddress\" onchange=\"updatePreview()\"><label for=\"highlight-schoolAddress\">\u5b66\u6821\u5730\u5740 (\u9875\u811a)</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-studentName\" name=\"highlight-studentName\" onchange=\"updatePreview()\"><label for=\"highlight-studentName\">\u59d3\u540d</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-studentAddress1\" name=\"highlight-studentAddress1\" onchange=\"updatePreview()\"><label for=\"highlight-studentAddress1\">\u5730\u5740\u884c1</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-studentAddress2\" name=\"highlight-studentAddress2\" onchange=\"updatePreview()\"><label for=\"highlight-studentAddress2\">\u5730\u5740\u884c2</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-sn\" name=\"highlight-sn\" onchange=\"updatePreview()\"><label for=\"highlight-sn\">SN</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-grade\" name=\"highlight-grade\" onchange=\"updatePreview()\"><label for=\"highlight-grade\">Grade</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-ssid\" name=\"highlight-ssid\" onchange=\"updatePreview()\"><label for=\"highlight-ssid\">SSID</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-gender\" name=\"highlight-gender\" onchange=\"updatePreview()\"><label for=\"highlight-gender\">Gender</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-birthdate\" name=\"highlight-birthdate\" onchange=\"updatePreview()\"><label for=\"highlight-birthdate\">Birthdate</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-gradDate\" name=\"highlight-gradDate\" onchange=\"updatePreview()\"><label for=\"highlight-gradDate\">Grad. Date</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-exitDate\" name=\"highlight-exitDate\" onchange=\"updatePreview()\"><label for=\"highlight-exitDate\">Exit Date</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-cumulativeCredit\" name=\"highlight-cumulativeCredit\" onchange=\"updatePreview()\"><label for=\"highlight-cumulativeCredit\">Cumulative Credit</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-cumulativeGpa\" name=\"highlight-cumulativeGpa\" onchange=\"updatePreview()\"><label for=\"highlight-cumulativeGpa\">Cumulative GPA</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-classRank\" name=\"highlight-classRank\" onchange=\"updatePreview()\"><label for=\"highlight-classRank\">Class Rank</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-footerNotes\" name=\"highlight-footerNotes\" onchange=\"updatePreview()\"><label for=\"highlight-footerNotes\">\u5907\u6ce8\u4fe1\u606f</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-transcriptGeneratedText\" name=\"highlight-transcriptGeneratedText\" onchange=\"updatePreview()\"><label for=\"highlight-transcriptGeneratedText\">\u751f\u6210\u6587\u672c</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-signatureLine1\" name=\"highlight-signatureLine1\" onchange=\"updatePreview()\"><label for=\"highlight-signatureLine1\">\u7b7e\u540d\u884c1</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-signatureLine2\" name=\"highlight-signatureLine2\" onchange=\"updatePreview()\"><label for=\"highlight-signatureLine2\">\u7b7e\u540d\u884c2</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-signatureLine3\" name=\"highlight-signatureLine3\" onchange=\"updatePreview()\"><label for=\"highlight-signatureLine3\">\u7b7e\u540d\u884c3</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-accreditation\" name=\"highlight-accreditation\" onchange=\"updatePreview()\"><label for=\"highlight-accreditation\">\u8ba4\u8bc1\u4fe1\u606f</label></div>\n                        <div class=\"highlight-setting\"><input type=\"checkbox\" id=\"highlight-issueDate\" name=\"highlight-issueDate\" onchange=\"updatePreview()\"><label for=\"highlight-issueDate\">\u7b7e\u53d1\u65e5\u671f</label></div>\n                    </div>\n                </div>\n            </form>\n        </div>\n        <div class=\"splitter\" id=\"splitter\">\n            <div class=\"splitter-handle\"></div>\n        </div>\n        <div class=\"preview-pane\" id=\"previewPane\">\n            <h2>\u6210\u7ee9\u5355\u5b9e\u65f6\u9884\u89c8</h2>\n            <div id=\"transcriptPreviewOutput\">\n                <p>\u7f16\u8f91\u5de6\u4fa7\u8868\u5355\u5185\u5bb9\u540e\uff0c\u6b64\u5904\u5c06\u5b9e\u65f6\u663e\u793a\u9884\u89c8\u6548\u679c\u3002</p>\n            </div>\n            <button type=\"button\" id=\"generateImageButton\" style=\"margin-top:15px; background-color: #5cb85c; color:white; border:none; padding: 10px 15px; cursor:pointer;\">\u751f\u6210\u56fe\u7247\u5e76\u4e0b\u8f7d</button>\n        </div>\n    </div>\n\n    <script>\n        // All JS from v6, including addPrintArtifacts, applyHighlight, generatePreviewHtml, updatePreview, etc.\n        // ... (JS from v6 - truncated for brevity)\n        let courseYearCounter = 0;\n        let gpaSummaryCounter = 0;\n        let courseCounter = 0;\n\n        function addCourseYear(initialData = null) {\n            courseYearCounter++;\n            const container = document.getElementById(\"courseYearsContainer\");\n            const yearBlock = document.createElement(\"div\");\n            yearBlock.classList.add(\"course-year-block\");\n            yearBlock.setAttribute(\"id\", `courseYear-${courseYearCounter}`);\n            \n            const defaultYearName = initialData?.yearName || ``;\n            const defaultYearSubName = initialData?.yearSubName || ``;\n\n            yearBlock.innerHTML = `\n                <h3>\u5b66\u5e74/\u5b66\u671f\u533a\u5757 #${courseYearCounter}</h3>\n                <label for=\"yearName-${courseYearCounter}\">\u533a\u5757\u6807\u9898 (\u4f8b\u5982: 19-20 Sun Canyon High):</label>\n                <input type=\"text\" id=\"yearName-${courseYearCounter}\" name=\"yearName-${courseYearCounter}\" value=\"${defaultYearName}\" oninput=\"updatePreview()\">\n                <input type=\"checkbox\" name=\"highlight-yearName-${courseYearCounter}\" onchange=\"updatePreview()\">\n                <label for=\"yearSubName-${courseYearCounter}\">\u533a\u5757\u526f\u6807\u9898 (\u53f3\u4fa7, \u4f8b\u5982: 16-17 Sun Canyon Middle):</label>\n                <input type=\"text\" id=\"yearSubName-${courseYearCounter}\" name=\"yearSubName-${courseYearCounter}\" value=\"${defaultYearSubName}\" oninput=\"updatePreview()\">\n                <input type=\"checkbox\" name=\"highlight-yearSubName-${courseYearCounter}\" onchange=\"updatePreview()\">\n                \n                <h4>\u5de6\u680f\u8bfe\u7a0b</h4>\n                <div id=\"coursesLeftContainer-${courseYearCounter}\"></div>\n                <button type=\"button\" class=\"add-button\" onclick=\"addCourseToYear(${courseYearCounter}, 'Left')\">\u6dfb\u52a0\u5de6\u680f\u8bfe\u7a0b</button>\n\n                <h4>\u53f3\u680f\u8bfe\u7a0b</h4>\n                <div id=\"coursesRightContainer-${courseYearCounter}\"></div>\n                <button type=\"button\" class=\"add-button\" onclick=\"addCourseToYear(${courseYearCounter}, 'Right')\">\u6dfb\u52a0\u53f3\u680f\u8bfe\u7a0b</button>\n                <button type=\"button\" style=\"background-color: #e74c3c; color:white; border:none; padding: 5px 8px; cursor:pointer; margin-left: 10px;\" onclick=\"removeCourseYear(${courseYearCounter})\">\u79fb\u9664\u6b64\u533a\u5757</button>\n            `;\n            container.appendChild(yearBlock);\n\n            if (initialData && initialData.coursesLeft) {\n                initialData.coursesLeft.forEach(course => addCourseToYear(courseYearCounter, \"Left\", course.name, course.credit, course.grades));\n            }\n            if (initialData && initialData.coursesRight) {\n                initialData.coursesRight.forEach(course => addCourseToYear(courseYearCounter, \"Right\", course.name, course.credit, course.grades));\n            }\n            if (!initialData) {\n                 addCourseToYear(courseYearCounter, \"Left\", \"Sample Course Left\", \"1.00\", \"A\");\n                 addCourseToYear(courseYearCounter, \"Right\", \"Sample Course Right\", \"1.00\", \"B\");\n            }\n            updatePreview();\n        }\n\n        function removeCourseYear(yearId) {\n            const yearBlock = document.getElementById(`courseYear-${yearId}`);\n            if (yearBlock) {\n                yearBlock.remove();\n                updatePreview();\n            }\n        }\n\n        function addCourseToYear(yearId, side, name = \"\", credit = \"\", grades = \"\") {\n            courseCounter++;\n            const containerId = `courses${side}Container-${yearId}`;\n            const container = document.getElementById(containerId);\n            if (!container) return;\n            const courseRow = document.createElement(\"div\");\n            courseRow.classList.add(\"course-row\");\n            courseRow.setAttribute(\"id\", `course-${courseCounter}`);\n            courseRow.innerHTML = `\n                <input type=\"text\" name=\"courseName-${yearId}-${side}-${courseCounter}\" placeholder=\"\u8bfe\u7a0b\u540d\u79f0\" value=\"${name}\" oninput=\"updatePreview()\">\n                <input type=\"checkbox\" name=\"highlight-courseName-${yearId}-${side}-${courseCounter}\" onchange=\"updatePreview()\">\n                <input type=\"text\" style=\"flex-grow:0.3;\" name=\"courseCredit-${yearId}-${side}-${courseCounter}\" placeholder=\"\u5b66\u5206\" value=\"${credit}\" oninput=\"updatePreview()\">\n                 <input type=\"checkbox\" name=\"highlight-courseCredit-${yearId}-${side}-${courseCounter}\" onchange=\"updatePreview()\">\n                <input type=\"text\" style=\"flex-grow:0.5;\" name=\"courseGrades-${yearId}-${side}-${courseCounter}\" placeholder=\"\u6210\u7ee9\" value=\"${grades}\" oninput=\"updatePreview()\">\n                 <input type=\"checkbox\" name=\"highlight-courseGrades-${yearId}-${side}-${courseCounter}\" onchange=\"updatePreview()\">\n                <button type=\"button\" style=\"background-color: #e74c3c; color:white; border:none; padding: 5px 8px; cursor:pointer;\" onclick=\"removeCourse(${courseCounter})\">\u79fb\u9664</button>\n            `;\n            container.appendChild(courseRow);\n            updatePreview();\n        }\n\n        function removeCourse(courseId) {\n            const courseRow = document.getElementById(`course-${courseId}`);\n            if (courseRow) {\n                courseRow.remove();\n                updatePreview();\n            }\n        }\n        \n        function addGpaSummaryLine(qName = \"\", qGpa = \"\", otherName = \"\", otherGpa = \"\") {\n            gpaSummaryCounter++;\n            const container = document.getElementById(\"gpaSummaryContainer\");\n            const lineRow = document.createElement(\"div\");\n            lineRow.classList.add(\"course-row\");\n            lineRow.setAttribute(\"id\", `gpaSummary-${gpaSummaryCounter}`);\n            lineRow.innerHTML = `\n                <input type=\"text\" name=\"gpaSummaryQName-${gpaSummaryCounter}\" placeholder=\"\u5b66\u671f/\u5e74\u5ea6\u540d\u79f0 (\u5982 09th Q1)\" value=\"${qName}\" oninput=\"updatePreview()\">\n                <input type=\"checkbox\" name=\"highlight-gpaSummaryQName-${gpaSummaryCounter}\" onchange=\"updatePreview()\">\n                <input type=\"text\" style=\"flex-grow:0.3;\" name=\"gpaSummaryQGpa-${gpaSummaryCounter}\" placeholder=\"GPA (\u5982 4.000)\" value=\"${qGpa}\" oninput=\"updatePreview()\">\n                <input type=\"checkbox\" name=\"highlight-gpaSummaryQGpa-${gpaSummaryCounter}\" onchange=\"updatePreview()\">\n                <input type=\"text\" name=\"gpaSummaryOtherName-${gpaSummaryCounter}\" placeholder=\"\u5176\u4ed6\u9879\u540d\u79f0 (\u5982 Other)\" value=\"${otherName}\" oninput=\"updatePreview()\">\n                <input type=\"checkbox\" name=\"highlight-gpaSummaryOtherName-${gpaSummaryCounter}\" onchange=\"updatePreview()\">\n                <input type=\"text\" style=\"flex-grow:0.3;\" name=\"gpaSummaryOtherGpa-${gpaSummaryCounter}\" placeholder=\"\u5176\u4ed6\u9879GPA (\u5982 4.000)\" value=\"${otherGpa}\" oninput=\"updatePreview()\">\n                <input type=\"checkbox\" name=\"highlight-gpaSummaryOtherGpa-${gpaSummaryCounter}\" onchange=\"updatePreview()\">\n                <button type=\"button\" style=\"background-color: #e74c3c; color:white; border:none; padding: 5px 8px; cursor:pointer;\" onclick=\"removeGpaSummaryLine(${gpaSummaryCounter})\">\u79fb\u9664</button>\n            `;\n            container.appendChild(lineRow);\n            updatePreview();\n        }\n\n        function removeGpaSummaryLine(lineId) {\n            const lineRow = document.getElementById(`gpaSummary-${lineId}`);\n            if (lineRow) {\n                lineRow.remove();\n                updatePreview();\n            }\n        }\n\n        function getFormData() {\n            const form = document.getElementById(\"transcriptForm\");\n            const data = {\n                schoolName: form.schoolName.value,\n                schoolPhone: form.schoolPhone.value,\n                schoolAddress: form.schoolAddress.value,\n                studentName: form.studentName.value,\n                studentAddress1: form.studentAddress1.value,\n                studentAddress2: form.studentAddress2.value,\n                sn: form.sn.value,\n                grade: form.grade.value,\n                ssid: form.ssid.value,\n                gender: form.gender.value,\n                birthdate: form.birthdate.value,\n                gradDate: form.gradDate.value,\n                exitDate: form.exitDate.value,\n                cumulativeCredit: form.cumulativeCredit.value,\n                cumulativeGpa: form.cumulativeGpa.value,\n                classRank: form.classRank.value,\n                gpa12thCredit: form.gpa12thCredit.value,\n                gpa12thGpa: form.gpa12thGpa.value,\n                gpa11thCredit: form.gpa11thCredit.value,\n                gpa11thGpa: form.gpa11thGpa.value,\n                gpa10thCredit: form.gpa10thCredit.value,\n                gpa10thGpa: form.gpa10thGpa.value,\n                gpa9thCredit: form.gpa9thCredit.value,\n                gpa9thGpa: form.gpa9thGpa.value,\n                actTestDate: form.actTestDate.value,\n                actComposite: form.actComposite.value,\n                actEnglish: form.actEnglish.value,\n                actMath: form.actMath.value,\n                actReading: form.actReading.value,\n                actScience: form.actScience.value,\n                actWriting: form.actWriting.value,\n                satTestDate: form.satTestDate.value,\n                satComposite: form.satComposite.value,\n                satEnglish: form.satEnglish.value,\n                satMath: form.satMath.value,\n                satWriting: form.satWriting.value,\n                courseYears: [],\n                gpaSummaries: [],\n                footerNotes: form.footerNotes.value,\n                transcriptGeneratedText: form.transcriptGeneratedText.value,\n                signatureLine1: form.signatureLine1.value,\n                signatureLine2: form.signatureLine2.value,\n                signatureLine3: form.signatureLine3.value,\n                accreditation: form.accreditation.value,\n                issueDate: form.issueDate.value,\n                highlightSettings: {\n                    schoolName: form['highlight-schoolName'].checked,\n                    schoolPhone: form['highlight-schoolPhone'].checked,\n                    schoolAddress: form['highlight-schoolAddress'].checked,\n                    studentName: form['highlight-studentName'].checked,\n                    studentAddress1: form['highlight-studentAddress1'].checked,\n                    studentAddress2: form['highlight-studentAddress2'].checked,\n                    sn: form['highlight-sn'].checked,\n                    grade: form['highlight-grade'].checked,\n                    ssid: form['highlight-ssid'].checked,\n                    gender: form['highlight-gender'].checked,\n                    birthdate: form['highlight-birthdate'].checked,\n                    gradDate: form['highlight-gradDate'].checked,\n                    exitDate: form['highlight-exitDate'].checked,\n                    cumulativeCredit: form['highlight-cumulativeCredit'].checked,\n                    cumulativeGpa: form['highlight-cumulativeGpa'].checked,\n                    classRank: form['highlight-classRank'].checked,\n                    footerNotes: form['highlight-footerNotes'].checked,\n                    transcriptGeneratedText: form['highlight-transcriptGeneratedText'].checked,\n                    signatureLine1: form['highlight-signatureLine1'].checked,\n                    signatureLine2: form['highlight-signatureLine2'].checked,\n                    signatureLine3: form['highlight-signatureLine3'].checked,\n                    accreditation: form['highlight-accreditation'].checked,\n                    issueDate: form['highlight-issueDate'].checked\n                }\n            };\n\n            const courseYearBlocks = document.querySelectorAll(\".course-year-block\");\n            courseYearBlocks.forEach(block => {\n                const yearId = block.id.split(\"-\")[1];\n                const yearData = {\n                    yearName: document.getElementById(`yearName-${yearId}`).value,\n                    highlightYearName: document.querySelector(`input[name=\"highlight-yearName-${yearId}\"]`).checked,\n                    yearSubName: document.getElementById(`yearSubName-${yearId}`).value,\n                    highlightYearSubName: document.querySelector(`input[name=\"highlight-yearSubName-${yearId}\"]`).checked,\n                    coursesLeft: [],\n                    coursesRight: []\n                };\n                const leftCourses = block.querySelectorAll(`#coursesLeftContainer-${yearId} .course-row`);\n                leftCourses.forEach(courseRow => {\n                    const courseId = courseRow.id.split(\"-\")[1];\n                    yearData.coursesLeft.push({\n                        name: courseRow.querySelector(`input[name^=\"courseName-${yearId}-Left\"]`).value,\n                        highlightName: courseRow.querySelector(`input[name^=\"highlight-courseName-${yearId}-Left\"]`).checked,\n                        credit: courseRow.querySelector(`input[name^=\"courseCredit-${yearId}-Left\"]`).value,\n                        highlightCredit: courseRow.querySelector(`input[name^=\"highlight-courseCredit-${yearId}-Left\"]`).checked,\n                        grades: courseRow.querySelector(`input[name^=\"courseGrades-${yearId}-Left\"]`).value,\n                        highlightGrades: courseRow.querySelector(`input[name^=\"highlight-courseGrades-${yearId}-Left\"]`).checked\n                    });\n                });\n                const rightCourses = block.querySelectorAll(`#coursesRightContainer-${yearId} .course-row`);\n                rightCourses.forEach(courseRow => {\n                     const courseId = courseRow.id.split(\"-\")[1];\n                    yearData.coursesRight.push({\n                        name: courseRow.querySelector(`input[name^=\"courseName-${yearId}-Right\"]`).value,\n                        highlightName: courseRow.querySelector(`input[name^=\"highlight-courseName-${yearId}-Right\"]`).checked,\n                        credit: courseRow.querySelector(`input[name^=\"courseCredit-${yearId}-Right\"]`).value,\n                        highlightCredit: courseRow.querySelector(`input[name^=\"highlight-courseCredit-${yearId}-Right\"]`).checked,\n                        grades: courseRow.querySelector(`input[name^=\"courseGrades-${yearId}-Right\"]`).value,\n                        highlightGrades: courseRow.querySelector(`input[name^=\"highlight-courseGrades-${yearId}-Right\"]`).checked\n                    });\n                });\n                data.courseYears.push(yearData);\n            });\n\n            const gpaSummaryRows = document.querySelectorAll(\"#gpaSummaryContainer .course-row\");\n            gpaSummaryRows.forEach(row => {\n                const sId = row.id.split(\"-\")[1];\n                data.gpaSummaries.push({\n                    qName: row.querySelector(`input[name^=\"gpaSummaryQName-${sId}\"]`).value,\n                    highlightQName: row.querySelector(`input[name^=\"highlight-gpaSummaryQName-${sId}\"]`).checked,\n                    qGpa: row.querySelector(`input[name^=\"gpaSummaryQGpa-${sId}\"]`).value,\n                    highlightQGpa: row.querySelector(`input[name^=\"highlight-gpaSummaryQGpa-${sId}\"]`).checked,\n                    otherName: row.querySelector(`input[name^=\"gpaSummaryOtherName-${sId}\"]`).value,\n                    highlightOtherName: row.querySelector(`input[name^=\"highlight-gpaSummaryOtherName-${sId}\"]`).checked,\n                    otherGpa: row.querySelector(`input[name^=\"gpaSummaryOtherGpa-${sId}\"]`).value,\n                    highlightOtherGpa: row.querySelector(`input[name^=\"highlight-gpaSummaryOtherGpa-${sId}\"]`).checked\n                });\n            });\n            return data;\n        }\n\n        // Simplified applyHighlight function\n        function applyHighlight(text, shouldHighlight) {\n            if (!text) return \"\";\n            if (shouldHighlight) {\n                return `<span style=\"background-color: yellow;\">${String(text)}</span>`;\n            } else {\n                return String(text);\n            }\n        }\n\n        function addPrintArtifacts(container) {\n            if (!container) return;\n            // Clear previous artifacts\n            const existingArtifacts = container.querySelectorAll(\".print-artifact\");\n            existingArtifacts.forEach(artifact => artifact.remove());\n\n            const artifactCount = Math.floor(Math.random() * 40) + 20; // Increased count range\n            for (let i = 0; i < artifactCount; i++) {\n                const artifact = document.createElement(\"div\");\n                artifact.classList.add(\"print-artifact\");\n                const size = Math.floor(Math.random() * 3) + 1; // Varying size\n                artifact.style.width = `${size}px`;\n                artifact.style.height = `${size}px`;\n                artifact.style.left = `${Math.random() * 100}%`;\n                artifact.style.top = `${Math.random() * 100}%`;\n                artifact.style.backgroundColor = `rgba(0, 0, 0, ${ (Math.random() * 0.4) + 0.1 })`; // Varying opacity\n                container.appendChild(artifact);\n            }\n        }\n\n        function generatePreviewHtml(data) {\n            let html = `\n                <style>\n                    .transcript-preview-container {\n                        font-family: \"Times New Roman\", Times, serif;\n                        font-size: 9pt; \n                        color: #000;\n                        background-color: #fff;\n                        padding: 22.5px; \n                        border: 1px solid #666;\n                        width: 9.5625in; \n                        min-height: 12.375in; \n                        box-sizing: border-box;\n                        margin: auto; \n                        position: relative; \n                    }\n                    .transcript-preview-container table { width: 100%; border-collapse: collapse; margin-bottom: 6px; table-layout: fixed; }\n                    .transcript-preview-container td, .transcript-preview-container th { text-align: left; padding: 1.5px 3px; vertical-align: top; word-wrap: break-word; }\n                    \n                    .header-main-title { font-size: 14pt; font-weight: bold; text-align: center; display: block; margin-bottom: 2px; }\n                    .header-school-name { font-size: 14pt; font-weight: bold; text-align: center; display: block; margin-bottom: 2px; }\n                    .header-school-phone { font-size: 10pt; text-align: center; display: block; margin-bottom: 11px; }\n\n                    .student-info-table { margin-bottom: 11px !important; border: 1px solid #000; }\n                    .student-info-table td { padding: 2px 4px; border: 1px solid #000; }\n                    .student-info-table .label { font-weight: bold; }\n\n                    .grades-summary-table { border: 1px solid #000; margin-bottom: 11px; }\n                    .grades-summary-table th { background-color: #eee; border: 1px solid #000; font-weight:bold; text-align: center; padding: 2px; }\n                    .grades-summary-table td { border: 1px solid #000; text-align: center; padding: 2px; }\n                    .grades-summary-table td:first-child { text-align: left; }\n                    \n                    .courses-header-table td { font-weight: bold; border-bottom: 1.5px solid #000; padding-bottom: 2px; margin-bottom: 2px;}\n                    .courses-header-table .course-col { width: 70%; }\n                    .courses-header-table .credit-col { width: 10%; text-align: center; }\n                    .courses-header-table .grades-col { width: 20%; text-align: center; }\n\n                    .course-block-title { font-weight: bold; margin-top: 9px; margin-bottom: 2px; font-size: 10pt; }\n                    \n                    .courses-table .course-col-data { width: 70%; }\n                    .courses-table .credit-col-data { width: 10%; text-align: center; padding: 0; }\n                    .courses-table .grades-col-data { width: 20%; text-align: center; }\n\n                    .footer-text { font-size: 8pt; margin-top: 15px; }\n                    .signature-area { margin-top: 22.5px; }\n                    .signature-line { border-top: 1px solid #000; width: 187.5px; margin: 22.5px 0 4px 0; }\n                    .text-right { text-align: right; }\n                    .text-center { text-align: center; }\n                    .two-column-courses { display: flex; justify-content: space-between; gap: 11px; }\n                    .two-column-courses > div { width: 49%; }\n                </style>\n                <div class=\"transcript-preview-container\" id=\"transcriptImageSource\">\n                    <div style=\"text-align: center;\">\n                        <span class=\"header-main-title\">Student Transcript</span>\n                        <span class=\"header-school-name\">${applyHighlight(data.schoolName, data.highlightSettings.schoolName)}</span>\n                        <span class=\"header-school-phone\">${applyHighlight(data.schoolPhone, data.highlightSettings.schoolPhone)}</span>\n                    </div>\n\n                    <table class=\"student-info-table\">\n                        <tr>\n                            <td class=\"label\">Student Name:</td><td>${applyHighlight(data.studentName, data.highlightSettings.studentName)}</td>\n                            <td class=\"label\">SN:</td><td>${applyHighlight(data.sn, data.highlightSettings.sn)}</td>\n                            <td class=\"label\">Grade:</td><td>${applyHighlight(data.grade, data.highlightSettings.grade)}</td>\n                        </tr>\n                        <tr>\n                            <td class=\"label\">Address:</td><td colspan=\"3\">${applyHighlight(data.studentAddress1, data.highlightSettings.studentAddress1)}${data.studentAddress2 ? \", \" + applyHighlight(data.studentAddress2, data.highlightSettings.studentAddress2) : \"\"}</td>\n                            <td class=\"label\">SSID:</td><td>${applyHighlight(data.ssid, data.highlightSettings.ssid)}</td>\n                        </tr>\n                        <tr>\n                            <td class=\"label\">Birthdate:</td><td>${applyHighlight(data.birthdate, data.highlightSettings.birthdate)}</td>\n                            <td class=\"label\">Gender:</td><td>${applyHighlight(data.gender, data.highlightSettings.gender)}</td>\n                            <td class=\"label\">Grad. Date:</td><td>${applyHighlight(data.gradDate, data.highlightSettings.gradDate)}</td>\n                        </tr>\n                         <tr>\n                            <td class=\"label\">Exit Date:</td><td>${applyHighlight(data.exitDate, data.highlightSettings.exitDate)}</td>\n                            <td colspan=\"4\"></td>\n                        </tr>\n                    </table>\n\n                    <table class=\"grades-summary-table\">\n                        <thead>\n                            <tr><th></th><th>Credit</th><th>GPA</th><th>Testing</th><th>ACT</th><th>SAT</th></tr>\n                        </thead>\n                        <tbody>\n                            <tr><td>Cumulative:</td><td>${applyHighlight(data.cumulativeCredit, data.highlightSettings.cumulativeCredit)}</td><td>${applyHighlight(data.cumulativeGpa, data.highlightSettings.cumulativeGpa)}</td><td>Test Date</td><td>${applyHighlight(data.actTestDate, data.highlightSettings.actTestDate)}</td><td>${applyHighlight(data.satTestDate, data.highlightSettings.satTestDate)}</td></tr>\n                            <tr><td>12th:</td><td>${applyHighlight(data.gpa12thCredit, data.highlightSettings.gpa12thCredit)}</td><td>${applyHighlight(data.gpa12thGpa, data.highlightSettings.gpa12thGpa)}</td><td>Composite</td><td>${applyHighlight(data.actComposite, data.highlightSettings.actComposite)}</td><td>${applyHighlight(data.satComposite, data.highlightSettings.satComposite)}</td></tr>\n                            <tr><td>11th:</td><td>${applyHighlight(data.gpa11thCredit, data.highlightSettings.gpa11thCredit)}</td><td>${applyHighlight(data.gpa11thGpa, data.highlightSettings.gpa11thGpa)}</td><td>English (v)</td><td>${applyHighlight(data.actEnglish, data.highlightSettings.actEnglish)}</td><td>${applyHighlight(data.satEnglish, data.highlightSettings.satEnglish)}</td></tr>\n                            <tr><td>10th:</td><td>${applyHighlight(data.gpa10thCredit, data.highlightSettings.gpa10thCredit)}</td><td>${applyHighlight(data.gpa10thGpa, data.highlightSettings.gpa10thGpa)}</td><td>Math (m)</td><td>${applyHighlight(data.actMath, data.highlightSettings.actMath)}</td><td>${applyHighlight(data.satMath, data.highlightSettings.satMath)}</td></tr>\n                            <tr><td>9th:</td><td>${applyHighlight(data.gpa9thCredit, data.highlightSettings.gpa9thCredit)}</td><td>${applyHighlight(data.gpa9thGpa, data.highlightSettings.gpa9thGpa)}</td><td>Reading</td><td>${applyHighlight(data.actReading, data.highlightSettings.actReading)}</td><td></td></tr>\n                            <tr><td>Class Rank:</td><td colspan=\"2\">${applyHighlight(data.classRank, data.highlightSettings.classRank)}</td><td>Science</td><td>${applyHighlight(data.actScience, data.highlightSettings.actScience)}</td><td></td></tr>\n                            <tr><td></td><td colspan=\"2\"></td><td>English Writing</td><td>${applyHighlight(data.actWriting, data.highlightSettings.actWriting)}</td><td>${applyHighlight(data.satWriting, data.highlightSettings.satWriting)}</td></tr>\n                        </tbody>\n                    </table>\n\n                    <table class=\"courses-header-table\">\n                        <tr>\n                           <td class=\"course-col\">School/Course</td><td class=\"credit-col\">Credit</td><td class=\"grades-col\">Grades</td>\n                           <td class=\"course-col\">School/Course</td><td class=\"credit-col\">Credit</td><td class=\"grades-col\">Grades</td>\n                        </tr>\n                    </table>\n                    `;\n\n            data.courseYears.forEach(year => {\n                html += `<div class=\"two-column-courses\">\n                            <div>\n                                <div class=\"course-block-title\">${applyHighlight(year.yearName, year.highlightYearName)}</div>\n                                <table class=\"courses-table\">\n                                    ${year.coursesLeft.map(c => `<tr><td class=\"course-col-data\">${applyHighlight(c.name, c.highlightName)}</td><td class=\"credit-col-data\">${applyHighlight(c.credit, c.highlightCredit)}</td><td class=\"grades-col-data\">${applyHighlight(c.grades, c.highlightGrades)}</td></tr>`).join(\"\")}\n                                </table>\n                            </div>\n                            <div>\n                                <div class=\"course-block-title\">${applyHighlight(year.yearSubName, year.highlightYearSubName)}</div>\n                                <table class=\"courses-table\">\n                                    ${year.coursesRight.map(c => `<tr><td class=\"course-col-data\">${applyHighlight(c.name, c.highlightName)}</td><td class=\"credit-col-data\">${applyHighlight(c.credit, c.highlightCredit)}</td><td class=\"grades-col-data\">${applyHighlight(c.grades, c.highlightGrades)}</td></tr>`).join(\"\")}\n                                </table>\n                            </div>\n                         </div>`;\n            });\n\n            html += `<div class=\"footer-text\" style=\"margin-top:11px;\">\n                        ${data.gpaSummaries.map(s => `<span>${applyHighlight(s.qName, s.highlightQName)}: ${applyHighlight(s.qGpa, s.highlightQGpa)} &nbsp;&nbsp; ${applyHighlight(s.otherName, s.highlightOtherName)}: ${applyHighlight(s.otherGpa, s.highlightOtherGpa)} &nbsp;&nbsp;&nbsp; </span>`).join(\"\")}\n                     </div>`;\n\n            html += `\n                    <div class=\"footer-text\">${applyHighlight(data.footerNotes, data.highlightSettings.footerNotes)}</div>\n                    <table style=\"width:100%; margin-top: 22.5px; table-layout: auto;\">\n                        <tr>\n                            <td>${applyHighlight(data.schoolAddress, data.highlightSettings.schoolAddress)}</td>\n                            <td class=\"text-center\">${applyHighlight(data.transcriptGeneratedText, data.highlightSettings.transcriptGeneratedText)}</td>\n                            <td class=\"text-right\"></td>\n                        </tr>\n                         <tr>\n                            <td style="padding-top:30px;" class="text-center">\n                                <div class="signature-line"></div>\n                                ${applyHighlight(data.signatureLine1, data.highlightSettings.signatureLine1)}\n                            </td>\n                             <td style="padding-top:30px;" class="text-center">\n                                <div class="signature-line" style="margin: 22.5px auto 4px auto;"></div>\n                                ${applyHighlight(data.signatureLine2, data.highlightSettings.signatureLine2)}\n                            </td>\n                            <td style="padding-top:30px;" class="text-center">\n                                <div class="signature-line" style="margin: 22.5px 0 4px auto;"></div>\n                                ${applyHighlight(data.signatureLine3, data.highlightSettings.signatureLine3)}\n                            </td>\n                        </tr>\n                        <tr>\n                            <td colspan=\"2\" style=\"padding-top:11px;\">${applyHighlight(data.accreditation, data.highlightSettings.accreditation)}</td>\n                            <td class=\"text-right\" style=\"padding-top:11px;\">${applyHighlight(data.issueDate, data.highlightSettings.issueDate)}</td>\n                        </tr>\n                    </table>\n                </div>`;\n            return html;\n        }\n\n        function updatePreview() {\n            const formData = getFormData();\n            const previewHtml = generatePreviewHtml(formData);\n            const previewOutput = document.getElementById(\"transcriptPreviewOutput\");\n            previewOutput.innerHTML = previewHtml;\n            \n            const transcriptImageSource = document.getElementById(\"transcriptImageSource\");\n            if (transcriptImageSource) {\n                addPrintArtifacts(transcriptImageSource); \n            }\n        }\n\n        document.addEventListener(\"DOMContentLoaded\", () => {\n            // Initialize default courses and GPA summaries (from v6)\n            addCourseYear({ \n                yearName: \"19-20 Sun Canyon High\", \n                yearSubName: \"16-17 Sun Canyon High (Drivers Ed)\",\n                coursesLeft: [\n                    { name: \"CE BIOL 1610/1615\", credit: \"0.33\", grades: \"A-\" },\n                    { name: \"CE BIOL 1615 Lab\", credit: \"0.25\", grades: \"A\" },\n                    { name: \"CE DES 1610 Screen Printing\", credit: \"0.25\", grades: \"A\" },\n                    { name: \"CE HLOC 1000 Medical Terminology\", credit: \"0.25\", grades: \"A-\" },\n                    { name: \"Study Skills AP Math Lab\", credit: \"0.25\", grades: \"P\" }\n                ],\n                coursesRight: [\n                    { name: \"Study Skills Chemistry Lab\", credit: \"1.00\", grades: \"P P P P\" },\n                    { name: \"Weight Training (9-12)\", credit: \"1.00\", grades: \"A A A A\" },\n                    { name: \"World Civ Honors\", credit: \"1.00\", grades: \"A A A A\" },\n                    { name: \"Drivers Ed\", credit: \"0.25\", grades: \"A\"}\n                ]\n            });\n            addCourseYear({ \n                yearName: \"18-19 Sun Canyon High\", \n                yearSubName: \"16-17 Sun Canyon Middle\",\n                coursesLeft: [\n                    { name: \"AP Chemistry\", credit: \"2.00\", grades: \"A A A- A-\" },\n                    { name: \"AP Language 11\", credit: \"1.00\", grades: \"A A A A\" },\n                    { name: \"AP US History\", credit: \"1.00\", grades: \"A A A A\" },\n                    { name: \"CE ART 1010\", credit: \"1.00\", grades: \"A\" },\n                    { name: \"CE FIN 1750\", credit: \"1.00\", grades: \"A A\" },\n                    { name: \"CE POLS 1100 Amr Gov\", credit: \"1.00\", grades: \"A\" },\n                    { name: \"Guitar I\", credit: \"0.50\", grades: \"A A\" },\n                    { name: \"Health II\", credit: \"0.50\", grades: \"A\" },\n                    { name: \"Physics with Technology\", credit: \"1.00\", grades: \"A A A A\" },\n                    { name: \"Secondary Mathematics 3 Honors\", credit: \"1.00\", grades: \"A A B+ A\" },\n                    { name: \"Study Skills Chemistry Lab\", credit: \"0.50\", grades: \"P P\" },\n                    { name: \"Weight Training (9-12)\", credit: \"0.50\", grades: \"A A\" }\n                ],\n                coursesRight: [\n                    { name: \"Biology Honors\", credit: \"1.00\", grades: \"A A A A\"},\n                    { name: \"Computer Technology\", credit: \"0.50\", grades: \"A\"},\n                    { name: \"Construction Technology\", credit: \"0.50\", grades: \"A A\"},\n                    { name: \"Geography for Life Honors\", credit: \"1.00\", grades: \"A A A\"},\n                    { name: \"Information & Communications Technology\", credit: \"0.50\", grades: \"A A\"},\n                    { name: \"Lang Arts 9 Honors\", credit: \"1.00\", grades: \"A A A A\"},\n                    { name: \"Physical Skills\", credit: \"0.50\", grades: \"A A\"},\n                    { name: \"Secondary Mathematics 1 Honors\", credit: \"1.00\", grades: \"A A A A\"},\n                    { name: \"Spanish I\", credit: \"1.00\", grades: \"A A A A\"}\n                ]\n            });\n            addCourseYear({ \n                yearName: \"17-18 Sun Canyon High\", \n                yearSubName: \"\",\n                coursesLeft: [\n                    { name: \"CAD Architectural Design 2\", credit: \"1.00\", grades: \"A A A A\" },\n                    { name: \"Ceramics I\", credit: \"0.50\", grades: \"A A\" },\n                    { name: \"Chemistry\", credit: \"1.00\", grades: \"A A A A\" },\n                    { name: \"Digital Graphics Arts Intro: Design\", credit: \"0.50\", grades: \"A A\" },\n                    { name: \"Fitness for Life\", credit: \"0.50\", grades: \"A\" },\n                    { name: \"Lang Arts 10 Honors\", credit: \"1.00\", grades: \"A A A A\" },\n                    { name: \"Secondary Mathematics 2 Honors\", credit: \"1.00\", grades: \"A A A A\" },\n                    { name: \"Spanish II\", credit: \"1.00\", grades: \"A A A A\" }\n                ],\n                coursesRight: []\n            });\n            addCourseYear({ \n                yearName: \"18-19 Utah Online School 7-12\", \n                yearSubName: \"\",\n                coursesLeft: [\n                    { name: \"Ukulele - Guitar\", credit: \"0.50\", grades: \"A\" }\n                ],\n                coursesRight: []\n            });\n\n            addGpaSummaryLine(\"09th Q1: 4.000\", \"Q2: 4.000\", \"Q3: 4.000\", \"Q4: 4.000 Other: 4.000\");\n            addGpaSummaryLine(\"10th Q1: 4.000\", \"Q2: 4.000\", \"Q3: 4.000\", \"Q4: 4.000 Other:\");\n            addGpaSummaryLine(\"11th Q1: 4.000\", \"Q2: 4.000\", \"Q3: 3.778\", \"Q4: 3.963 Other:\");\n            addGpaSummaryLine(\"12th Q1: 3.821\", \"Q2:\", \"Q3:\", \"Q4: Other:\");\n            \n            const allInputs = document.querySelectorAll(\"#transcriptForm input, #transcriptForm textarea, #transcriptForm select\");\n            allInputs.forEach(input => {\n                input.addEventListener(\"input\", updatePreview);\n                input.addEventListener(\"change\", updatePreview);\n            });\n\n            updatePreview(); // Initial preview generation\n\n            // Splitter logic\n            const splitter = document.getElementById(\"splitter\");\n            const editorPane = document.getElementById(\"editorPane\");\n            const previewPane = document.getElementById(\"previewPane\");\n            let isDragging = false;\n\n            // Set initial flex basis (e.g., 60% editor, 40% preview)\n            editorPane.style.flexBasis = \"60%\";\n            previewPane.style.flexBasis = \"40%\";\n\n            splitter.addEventListener(\"mousedown\", (e) => {\n                isDragging = true;\n                document.body.style.cursor = \"col-resize\"; // Change cursor for the whole body during drag\n                document.body.style.userSelect = \"none\"; // Prevent text selection during drag\n            });\n\n            document.addEventListener(\"mousemove\", (e) => {\n                if (!isDragging) return;\n                const container = document.querySelector(\".main-container\");\n                const containerRect = container.getBoundingClientRect();\n                let editorWidth = e.clientX - containerRect.left - (splitter.offsetWidth / 2);\n                \n                // Constrain editor width\n                const minEditorWidth = 200; // px\n                const minPreviewWidth = 200; // px\n                const maxEditorWidth = container.offsetWidth - splitter.offsetWidth - minPreviewWidth;\n\n                if (editorWidth < minEditorWidth) editorWidth = minEditorWidth;\n                if (editorWidth > maxEditorWidth) editorWidth = maxEditorWidth;\n\n                const editorPercentage = (editorWidth / (container.offsetWidth - splitter.offsetWidth)) * 100;\n                const previewPercentage = 100 - editorPercentage;\n\n                editorPane.style.flexBasis = `${editorPercentage}%`;\n                previewPane.style.flexBasis = `${previewPercentage}%`;\n            });\n\n            document.addEventListener(\"mouseup\", () => {\n                if (isDragging) {\n                    isDragging = false;\n                    document.body.style.cursor = \"default\";\n                    document.body.style.userSelect = \"auto\";\n                }\n            });\n\n            // Image generation logic (from v6)\n            const generateImageButton = document.getElementById(\"generateImageButton\");\n            if (generateImageButton) {\n                generateImageButton.addEventListener(\"click\", () => {\n                    const transcriptElement = document.getElementById(\"transcriptImageSource\");\n                    if (window.html2canvas) {\n                        html2canvas(transcriptElement, { \n                            scale: 2, \n                            useCORS: true, \n                            logging: true,\n                            width: transcriptElement.scrollWidth, \n                            height: transcriptElement.scrollHeight \n                        }).then(canvas => {\n                            const image = canvas.toDataURL(\"image/jpeg\", 0.9);\n                            const link = document.createElement(\"a\");\n                            link.download = \"transcript.jpg\";\n                            link.href = image;\n                            link.click();\n                        }).catch(err => {\n                            console.error(\"Error generating image:\", err);\n                            alert(\"\u56fe\u7247\u751f\u6210\u5931\u8d25\uff0c\u8bf7\u67e5\u770b\u63a7\u53f0\u83b7\u53d6\u66f4\u591a\u4fe1\u606f\u3002\");\n                        });\n                    } else {\n                        alert(\"html2canvas \u5e93\u672a\u52a0\u8f7d\uff0c\u65e0\u6cd5\u751f\u6210\u56fe\u7247\u3002\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u6216\u8054\u7cfb\u7ba1\u7406\u5458\u3002\");\n                    }\n                });\n            }\n        });\n\n        // html2canvas loader (from v6)\n        (function() {\n            if (!document.getElementById(\"html2canvas-script\")) {\n                const script = document.createElement(\"script\");\n                script.id = \"html2canvas-script\";\n                script.src = \"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js\";\n                script.onload = () => {\n                    console.log(\"html2canvas loaded successfully.\");\n                };\n                script.onerror = () => {\n                    console.error(\"Failed to load html2canvas.\");\n                    const genButton = document.getElementById(\"generateImageButton\");\n                    if(genButton) genButton.disabled = true;\n                    alert(\"\u65e0\u6cd5\u52a0\u8f7dhtml2canvas\u5e93\uff0c\u56fe\u7247\u751f\u6210\u529f\u80fd\u5c06\u4e0d\u53ef\u7528\u3002\");\n                };\n                document.head.appendChild(script);\n            }\n        })();\n\n    </script>\n</body>\n</html>\n\n"; // Python variable inserted here
    return new Response(editorHtml, {
      headers: { 'Content-Type': 'text/html;charset=UTF-8' },
    });
  }

  // Placeholder for other routes or API endpoints if needed in the future
  /*
  if (url.pathname === '/generate-image-server-side') {
    // ... logic to handle server-side image generation ...
    return new Response('Image generation endpoint (server-side - not implemented)', { headers: { 'Content-Type': 'text/plain' } });
  }
  */

  return new Response('Not found', { status: 404 });
}
